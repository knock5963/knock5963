var ninzuEvent={},ninzuEvent10={},ninzuMonth={},ninzuLastyear={},ninzuSeason={};function dp(n){var H=[],i=[],R=[],o=[],_=[],T=[],N=[],u={},r=[],s={};$(n.records).each(function(n,_){var T=_[0]+"",C=T.substr(0,4),a=T.substr(4,2),t=C+"/"+a+"/"+T.substr(6,2),e=C+"/"+a,E=("01"==a||"02"==a?parseInt(C)-1:C)+cms(a);if(H.push(t),i.push(_[1]),R.push(_[1]-_[2]),o.push(_[2]),null==u[e])u[e]=[1,_[1],_[2]],N.push(e);else{var A=u[e];A[0]+=1,A[1]+=_[1],A[2]+=_[2],u[e]=A}if(null==s[E])s[E]=[1,_[1],_[2]],r.push(E);else{var S=s[E];S[0]+=1,S[1]+=_[1],S[2]+=_[2],s[E]=S}}),ninzuEvent.C=H,ninzuEvent.t=i,ninzuEvent.A=R,ninzuEvent.S=o;for(var C=10;0<C;C--)_.push(H[H.length-C]),T.push(i[i.length-C]);ninzuEvent10.C=_,ninzuEvent10.t=T,ninzuMonth.C=N;var a=new Date,t=("0"+(a.getMonth()+1)).slice(-2),e=a.getFullYear()+"/"+t,E=a.getFullYear()-1+"/"+t,A=[],S=[],z=[],L=[],c=[],v=[],h=[];$(N).each(function(n,_){_!=e&&_!=E||(c.push(_),v.push((u[_][1]-u[_][2])/u[_][0]),h.push(u[_][2]/u[_][0])),A.push(u[_][1]-u[_][2]),S.push(u[_][2]),z.push((u[_][1]-u[_][2])/u[_][0]),L.push(u[_][2]/u[_][0])}),ninzuMonth.A=A,ninzuMonth.S=S,ninzuMonth.H=z,ninzuMonth.i=L,ninzuLastyear.C=c,ninzuLastyear.A=v,ninzuLastyear.S=h,ninzuSeason.C=r;var d=[],D=[];$(r).each(function(n,_){d.push((s[_][1]-s[_][2])/s[_][0]),D.push(s[_][2]/s[_][0])}),ninzuSeason.A=d,ninzuSeason.S=D;var P={title:{text:""},tooltip:{},toolbox:{},legend:{},dataZoom:[],xAxis:{},yAxis:{},series:[]},G=echarts.init(document.getElementById("chart_month"),CCTH),M=$.extend(!0,{},P);M.legend.data=[CCLC,CCLJ],M.xAxis.data=ninzuMonth.C,M.series.push({name:CCLC,type:CCTB,stack:CCST,data:ninzuMonth.A}),M.series.push({name:CCLJ,type:CCTB,stack:CCST,data:ninzuMonth.S}),G.setOption(M);var m=echarts.init(document.getElementById("chart_monthavg"),CCTH),y=$.extend(!0,{},P);y.legend.data=[CCLC,CCLJ],y.xAxis.data=ninzuMonth.C,y.series.push({name:CCLC,type:CCTB,stack:CCST,data:ninzuMonth.H}),y.series.push({name:CCLJ,type:CCTB,stack:CCST,data:ninzuMonth.i}),m.setOption(y);var l=echarts.init(document.getElementById("chart_lastyear"),CCTH),p=$.extend(!0,{},P);p.legend.data=[CCLC,CCLJ],p.xAxis.data=ninzuLastyear.C,p.series.push({name:CCLC,type:CCTB,data:ninzuLastyear.A,barMaxWidth:70}),p.series.push({name:CCLJ,type:CCTB,data:ninzuLastyear.S,barMaxWidth:70}),l.setOption(p);var Y=echarts.init(document.getElementById("chart_season"),CCTH),J=$.extend(!0,{},P);J.legend.data=[CCLC,CCLJ],J.xAxis.data=ninzuSeason.C,J.series.push({name:CCLC,type:CCTB,data:ninzuSeason.A}),J.series.push({name:CCLJ,type:CCTB,data:ninzuSeason.S}),Y.setOption(J);var f=echarts.init(document.getElementById("chart_overall"),CCTH),I=$.extend(!0,{},P);I.legend.data=[CCLC,CCLJ,CCLT],I.xAxis.data=ninzuEvent.C,I.toolbox={feature:{dataZoom:{show:!1,yAxisIndex:"none"}}},I.u=[{show:!0,realtime:!0,start:70,end:100},{type:"inside",realtime:!0,start:70,end:100}],I.series.push({name:CCLC,type:CCTL,data:ninzuEvent.A}),I.series.push({name:CCLJ,type:CCTL,data:ninzuEvent.S}),I.series.push({name:CCLT,type:CCTL,data:ninzuEvent.t}),f.setOption(I)}function cms(n){var _=parseInt(n);return DMS.length>n?DMS[_]:"？"}$(document).ready(function(){CSV.fetch({url:"data/ninzu.csv"}).done(dp)});var CCTH="macarons",CCTB="bar",CCTL="line",CCLC="中国の方",CCLJ="日本の方",CCLT="合計",CCST="人数",S1="春",S2="夏",S3="秋",S4="冬",DMS=["-",S4,S4,S1,S1,S1,S2,S2,S2,S3,S3,S3,S4];